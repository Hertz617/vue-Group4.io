import{_ as S,d as I,o as w,h as y,i as f,a as l,w as o,F as L,g as U,j as v,k as E,b,l as F,e as C,f as B,E as $}from"./index-1ed31e3c.js";import{E as r,a as k,b as D,c as W}from"./el-select-d613de18.js";import{s as z,a as N,b as M,c as T}from"./subject-ddd32c29.js";/* empty css                   */import{c as P}from"./cloneDeep-d951e9a5.js";const A=I({data(){return{fileList:"",fileList:[],fileType:["pdf","doc","docx","xls","xlsx","txt","png","jpg","bmp","jpeg"],fileSize:50,fileLimit:5,searchText:"",subjects:[],subject:[],page:{total:0,current:2,size:10},dialogFormVisible:!1,dialogFormVisibleById:!1,Subject:{attachment:"",fee:0,finished:"",id:0,level:"",name:"",origin:"",participant:"",period:"",subjectNo:"",type:"",userId:0},formLabelWidth:80}},mounted(){this.getSubjectsById(parseInt(localStorage.getItem("UserID")))},methods:{beforeUpload(e){if(e.type!=""||e.type!=null||e.type!=null){const t=e.name.replace(/.+\./,"").toLowerCase();return e.size/1024/1024<50?this.fileType.includes(t)?!0:(this.$message.error("上传文件格式不正确!"),!1):(this.$showMessage("上传文件大小不能超过 50MB!"),!1)}},handleRemove(){},handleClose(e){this.fileList.splice(e,1),this.fileList.length==0&&(this.fileflag=!0,this.$set(this.rules.url,0,{required:!0,validator:this.validatorUrl,trigger:"blur"}))},handleExceed(){this.$message({type:"warning",message:"超出最大上传文件数量的限制！"})},uploadFile(e){this.$showMessage("文件上传中........");let t=new FormData;t.append("file",e.file),this.$axios({method:"post",url:"/file/fileUpload",headers:this.headers,timeout:3e4,data:t}).then(s=>{if(s.data.id!=""||s.data.id!=null){this.fileList.push(e.file);let n=this.fileList.indexOf(e.file);this.fileList[n].id=s.data.id,this.fileList.length>0&&(this.fileflag=!1,this.$set(this.rules.url,0,""))}})},handleSuccess(){},toEdit(e){this.dialogFormVisible=!0,this.Subject=P(e)},getSubjectsPage(e){console.log("page"),z({current:e,size:4}).then(s=>{const n=s.data.page;this.subjects=n.records,this.page=n}).catch(s=>{console.log(s)})},getSubjectsById(e){console.log("userid"),this.subject=[],N({id:e}).then(s=>{console.log(s),this.dialogFormVisibleById=!1;const n=s.data;this.subjects=n.subjects,this.page=n}).catch(s=>{r("您尚未上传课题"),console.log(s)})},currentchange(e){console.log("current"),this.getSubjectsById(parseInt(localStorage.getItem("UserID"))),this.page.current=e},del(e){if(confirm("是否删除")==!0){console.log(e);const t={id:e};subjectDelId(t).then(s=>{if(s.success)this.getSubjectsById(parseInt(localStorage.getItem("UserID")));else return console.log(s.msg),!1}).catch(s=>{r("删除失败")})}},toAdd(){this.dialogFormVisible=!0,this.Subject={attachment:"",fee:0,finished:"",id:0,level:"",name:"",origin:"",participant:"",period:"",subjectNo:"",type:"",userId:parseInt(localStorage.getItem("UserID"))}},selectById(){this.dialogFormVisibleById=!0},refresh(){this.getSubjectsPage(1)},save(){const e=this.Subject;console.log(this.Subject),e.id==0?(console.log("add"),M(e).then(t=>{if(t.success)this.dialogFormVisible=!1,this.getSubjectsById(parseInt(localStorage.getItem("UserID")));else return r(t.msg),!1}).catch(t=>{r("网络错误联系管理员")})):(console.log("edit"),T(e).then(t=>{if(t.success)this.dialogFormVisible=!1,this.getSubjectsById(parseInt(localStorage.getItem("UserID"))),r(t.msg);else return r(t.msg),!1}).catch(t=>{r("网络错误联系管理员")}))}}}),O={class:"subjects"},_={class:"subject-tools"},q={class:"dialog-footer"};function R(e,t,s,n,G,H){const p=U,i=F,h=v,g=k,u=C,d=B,m=D,c=W,j=$,V=E;return w(),y(L,null,[f("div",O,[f("div",_,[l(p,{type:"warning",onClick:e.toAdd},{default:o(()=>[b("添加")]),_:1},8,["onClick"])]),l(h,{data:e.subjects,style:{width:"100%"}},{default:o(()=>[l(i,{fixed:"",prop:"id",label:"编号",width:"60",align:"center"}),l(i,{prop:"name",label:"课题名称"}),l(i,{prop:"userId",label:"负责人"}),l(i,{prop:"origin",label:"课题来源"}),l(i,{prop:"fee",label:"课题费用"}),l(i,{prop:"finished",label:"是否结项"}),l(i,{prop:"participant",label:"参与者"}),l(i,{prop:"period",label:"课题周期"}),l(i,{prop:"level",label:"课题等级"}),l(i,{prop:"subjectNo",label:"课题编号"}),l(i,{prop:"type",label:"课题类型"}),l(i,{prop:"attachment",label:"佐证材料"}),l(i,{fixed:"right",label:"功能管理",width:"120"},{default:o(a=>[l(p,{link:"",type:"primary",size:"small",onClick:J=>e.toEdit(a.row)},{default:o(()=>[b("更新")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l(g,{layout:"prev, pager, next","page-size":e.page.size,total:e.page.total,onCurrentChange:e.currentchange},null,8,["page-size","total","onCurrentChange"])]),l(V,{modelValue:e.dialogFormVisible,"onUpdate:modelValue":t[11]||(t[11]=a=>e.dialogFormVisible=a),title:"课题信息编辑"},{footer:o(()=>[f("span",q,[l(p,{onClick:t[10]||(t[10]=a=>e.dialogFormVisible=!1)},{default:o(()=>[b("Cancel")]),_:1}),l(p,{type:"primary",onClick:e.save},{default:o(()=>[b("保存 ")]),_:1},8,["onClick"])])]),default:o(()=>[l(j,{model:e.Subject},{default:o(()=>[l(d,{label:"课题名称","label-width":e.formLabelWidth},{default:o(()=>[l(u,{modelValue:e.Subject.name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.Subject.name=a),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(d,{label:"课题来源","label-width":e.formLabelWidth},{default:o(()=>[l(u,{modelValue:e.Subject.origin,"onUpdate:modelValue":t[1]||(t[1]=a=>e.Subject.origin=a),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(d,{label:"课题费用","label-width":e.formLabelWidth},{default:o(()=>[l(u,{modelValue:e.Subject.fee,"onUpdate:modelValue":t[2]||(t[2]=a=>e.Subject.fee=a),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(d,{label:"是否结项","label-width":e.formLabelWidth},{default:o(()=>[l(c,{modelValue:e.Subject.finished,"onUpdate:modelValue":t[3]||(t[3]=a=>e.Subject.finished=a),placeholder:"请选择是否结项",autocomplete:"off"},{default:o(()=>[l(m,{label:"是",value:"是"}),l(m,{label:"否",value:"否"})]),_:1},8,["modelValue"])]),_:1},8,["label-width"]),l(d,{label:"参与者","label-width":e.formLabelWidth},{default:o(()=>[l(u,{modelValue:e.Subject.participant,"onUpdate:modelValue":t[4]||(t[4]=a=>e.Subject.participant=a),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(d,{label:"课题周期","label-width":e.formLabelWidth},{default:o(()=>[l(u,{modelValue:e.Subject.period,"onUpdate:modelValue":t[5]||(t[5]=a=>e.Subject.period=a),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(d,{label:"课题等级","label-width":e.formLabelWidth},{default:o(()=>[l(u,{modelValue:e.Subject.level,"onUpdate:modelValue":t[6]||(t[6]=a=>e.Subject.level=a),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(d,{label:"课题编号","label-width":e.formLabelWidth},{default:o(()=>[l(u,{modelValue:e.Subject.subjectNo,"onUpdate:modelValue":t[7]||(t[7]=a=>e.Subject.subjectNo=a),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),l(d,{label:"课题类型","label-width":e.formLabelWidth},{default:o(()=>[l(c,{modelValue:e.Subject.type,"onUpdate:modelValue":t[8]||(t[8]=a=>e.Subject.type=a),placeholder:"请选择课题类型",autocomplete:"off"},{default:o(()=>[l(m,{label:"科技类",value:"科技类"}),l(m,{label:"教改类",value:"教改类"})]),_:1},8,["modelValue"])]),_:1},8,["label-width"]),l(d,{label:"佐证材料","label-width":e.formLabelWidth},{default:o(()=>[l(u,{modelValue:e.Subject.attachment,"onUpdate:modelValue":t[9]||(t[9]=a=>e.Subject.attachment=a),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"])]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}const x=S(A,[["render",R]]);export{x as default};
